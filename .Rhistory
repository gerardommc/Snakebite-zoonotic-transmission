dev.off()
### RMSE
rmse.sb <- readRDS("Model-results/SLA-disctricts-CAR-RMSE.rds")
rmse.env <- readRDS("Model-results/SLA-districts-CAR-RMSE-envs.rds")
# Snakebites
rmse.sb.pl <- ggplot(rmse.sb, aes(x = long, y = lat, group = group, fill = rmse)) +
geom_polygon(colour = "grey50") +
scale_fill_gradientn(colours = rev(cool(100))) +
coord_equal() +
labs(x = "x", y = "y", title = "RMSE", fill = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(face = "bold",
size = 22,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
rmse.env.pl <- ggplot(rmse.env, aes(x = long, y = lat, group = group, fill = rmse.env)) +
geom_polygon(colour = "grey50") +
scale_fill_gradientn(colours = rev(cool(100))) +
coord_equal()+
labs(x = "x", y = "y", title = "RMSE", fill = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(face = "bold",
size = 22,
hjust = 0.5),
axis.text = element_text(size = 10),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
pdf("Figures/RMSE-snakebites.pdf", width = 7.5/2, height = 21/4)
rmse.sb.pl
dev.off()
pdf("Figures/RMSE-envenomings.pdf", width = 7.5/2, height = 21/4)
rmse.env.pl
dev.off()
## Survey data
surv.data <- read.csv("Data/data.for.prevmap.csv")
library(sp)
coordinates(surv.data) <- ~ cluster_long + cluster_lat
proj4string(surv.data) <- CRS("+init=epsg:4326")
surv.data.sl <- spTransform(surv.data, CRSobj = CRS("+init=epsg:5235"))
surv.data.df <- data.frame(coordinates(surv.data.sl), surv.data.sl@data)
sb.incid.r <- raster("Model-results/Spatial/Snakebites/Incidence.asc")
env.incid.r <- raster("Model-results/Spatial/Envenomings/Incidence.asc")
surv.data.df$sb.pred <- extract(sb.incid.r, coordinates(surv.data.sl))
surv.data.df$env.pred <- extract(env.incid.r, coordinates(surv.data.sl))
surv.data.df$sb.prev <- with(surv.data.df, n_bitten/n_sampled)
surv.data.df$env.prev <- with(surv.data.df, n_envenom/n_sampled)
surv.data.df$sb.resids <- with(surv.data.df, sb.prev - sb.pred)
surv.data.df$env.resids <- with(surv.data.df, env.prev - env.pred)
sb.res.pl <-ggplot() + geom_polygon(data = sl, aes(x = long, y = lat, group = group), fill = "lightgrey") +
geom_point(data = surv.data.df, aes(x = cluster_long, y = cluster_lat, size = sb.resids), shape = 1, alpha = 0.3)+
scale_color_gradientn(colours = rev(cool(100))) +
coord_equal() +
labs(x = "x", y = "y", title = "Survey data residuals", size = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(face = "bold",
size = 22,
hjust = 0.5),
axis.text = element_text(size = 10),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
env.res.pl <-ggplot() + geom_polygon(data = sl, aes(x = long, y = lat, group = group), fill = "lightgrey") +
geom_point(data = surv.data.df, aes(x = cluster_long, y = cluster_lat, size = env.resids), shape = 1, alpha = 0.3)+
scale_color_gradientn(colours = rev(cool(100))) +
coord_equal() +
labs(x = "x", y = "y", title = "Survey data residuals", size = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(face = "bold",
size = 2,
hjust = 0.5),
axis.text = element_text(size = 10),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
pdf("Figures/Survey-residuals-snakebites.pdf", width = 7.5/2, height = 21/4)
sb.res.pl
dev.off()
pdf("Figures/Survey-residuals-envenomings.pdf", width = 7.5/2, height = 21/4)
env.res.pl
dev.off()
library(raster); library(ggplot2); library(rgdal); library(SpatialPack);
library(cowplot)
incid.data <- read.csv("Data/Incid-data.csv")[, -1]
incid.data$No.bites <- with(incid.data, bites * hum.pop)
incid.data$No.envs <- with(incid.data, envenomings * hum.pop)
inc.data <- rasterFromXYZ(incid.data[, c("x", "y", "bites")])
bit.data <- rasterFromXYZ(incid.data[, c("x", "y", "No.bites")])
##Snakebite plots
bites <- rasterToPoints(raster("Model-results/Spatial/Snakebites/No-bites.asc"))
incid <- rasterToPoints(raster("Model-results/Spatial/Snakebites/Incidence.asc"))
sl <- readOGR("Data/Sri Lanka boundaries/LKA_adm0.shp")
sl <- spTransform(sl, CRSobj = CRS("+init=epsg:5235"))
bites.df <- data.frame(bites)
bites.df$bites.data <- incid.data$No.bites
names(bites.df) <- c("x", "y", "model", "data")
incid.df <- data.frame(incid)
incid.df$inc.data <- incid.data$bites
names(incid.df) <- c("x", "y", "data", "model")
library(RColorBrewer)
cool.cols <- colorRampPalette(c("midnightblue",
"turquoise3",
"violetred3",
"goldenrod1",
"grey95"))
#Bites
bites <- ggplot() + geom_tile(data = bites.df,
aes(x = x, y = y, fill = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100)),
breaks = c(10, 160, 300)) +
geom_polygon(data = sl,
aes(x=long, y=lat, group = group),
fill=NA, color="grey50", size=1.25) +
coord_fixed(ratio = 1) +
labs(fill = "", title = "Number of snakebites")+
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.95, 0.65),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(15, units = "mm"),
plot.title = element_text(face = "bold",
size = 22,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
cor.bit <- modified.ttest(x = bites.df$data, y = bites.df$model,
coords = bites.df[, c("x", "y")])
cor.bites <- ggplot(bites.df) + geom_hex(aes(x = data, y = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100)), trans = "log",
labels = c(1, 7, 50, 400)) +
xlim(0, 350) + ylim(0, 350) + coord_fixed(ratio = 1) +
geom_abline(slope = 1, intercept = 0, colour = "red", size = 1.5, alpha = 0.5) +
geom_text(aes(x = 200, y = 100, label= paste0(
"r = ", round(cor.bit$corr,2),
"\n d.f. = ", round(cor.bit$dof, 0),
"\n P = ", round(cor.bit$p.value, 2)
)), fontface = "plain", size = 6) +
labs(x = "Data", y = "Model") +
theme(
legend.position = "none",
panel.background = element_rect(colour = "grey40", fill = NA),
rect = element_rect(fill = "transparent"),
axis.title = element_text(size = 18)
)
bites.inset = ggdraw() +
draw_plot(bites) +
draw_plot(cor.bites, x = 0.6, y = 0.7, width = 0.3, height = 0.3)
#####
#Incidence
incidence <- ggplot() + geom_tile(data = incid.df,
aes(x = x, y = y, fill = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100))) +
geom_polygon(data = sl,
aes(x=long, y=lat, group = group),
fill=NA, color="grey50", size=1.25) +
coord_fixed(ratio = 1) +
labs(fill = "", title = "Snakebite incidence")+
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.95, 0.65),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(15, units = "mm"),
plot.title = element_text(face = "bold",
size = 22,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
cor.inc <- modified.ttest(x = incid.df$data, y = incid.df$model,
coords = incid.df[, c("x", "y")])
cor.incidence <- ggplot(incid.df) + geom_hex(aes(x = data, y = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100)), trans = "log",
labels = c(1, 3, 7, 20, 1)) +
xlim(0, 0.01) + ylim(0, 0.01) + coord_fixed(ratio = 1) +
geom_abline(slope = 1, intercept = 0, colour = "red", size = 1.5, alpha = 0.5) +
geom_text(aes(x = 0.0035, y = 0.0065, label= paste0(
"r = ", round(cor.inc$corr,2),
"\n d.f. = ", round(cor.inc$dof, 0),
"\n P = ", round(cor.inc$p.value, 2)
)), fontface = "plain", size = 6) +
labs(x = "Data", y = "Model") +
theme(
legend.position = "none",
panel.background = element_rect(colour = "grey40", fill = "white"),
rect = element_rect(fill = "transparent"),
axis.title = element_text(size = 18)
)
bit.incid.inset = ggdraw() +
draw_plot(incidence) +
draw_plot(cor.incidence, x = 0.6, y = 0.7, width = 0.3, height = 0.3)
################################
##Envenoming
envs <- rasterToPoints(raster("Model-results/Spatial/Envenomings/No-envenomings.asc"))
env.inc <- rasterToPoints(raster("Model-results/Spatial/Envenomings/Incidence.asc"))
envs.df <- data.frame(envs)
envs.df$data <- incid.data$No.envs
names(envs.df) <- c("x", "y", "model", "data")
env.inc.df <- data.frame(env.inc)
env.inc.df$data <- incid.data$envenomings
names(env.inc.df) <- c("x", "y", "model", "data")
#Number of envenomings
envs <- ggplot() + geom_tile(data = envs.df,
aes(x = x, y = y, fill = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100)),
breaks = c(10, 75, 150)) +
geom_polygon(data = sl,
aes(x=long, y=lat, group = group),
fill=NA, color="grey50", size=1.25) +
coord_fixed(ratio = 1) +
labs(fill = "", title = "Number of envenomings")+
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.95, 0.65),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(15, units = "mm"),
plot.title = element_text(face = "bold",
size = 22,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
cor.env <- modified.ttest(x = envs.df$data, y = envs.df$model,
coords = envs.df[, c("x", "y")])
cor.envs <- ggplot(envs.df) + geom_hex(aes(x = data, y = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100)), trans = "log") +
xlim(0, 160) + ylim(0, 160) + coord_fixed(ratio = 1) +
geom_abline(slope = 1, intercept = 0, colour = "red", size = 1.5, alpha = 0.5) +
geom_text(aes(x = 45, y = 100, label= paste0(
"r = ", round(cor.env$corr,2),
"\n d.f. = ", round(cor.env$dof, 0),
"\n P = ", round(cor.env$p.value, 2)
)), fontface = "plain", size = 6) +
labs(x = "Data", y = "Model") +
theme(
legend.position = "none",
panel.background = element_rect(colour = "grey40", fill = NA),
rect = element_rect(fill = "transparent"),
axis.title = element_text(size = 18)
)
envs.inset = ggdraw() +
draw_plot(envs) +
draw_plot(cor.envs, x = 0.6, y = 0.7, width = 0.3, height = 0.3)
#Envenoming incidence
env.inc <- ggplot() + geom_tile(data = env.inc.df,
aes(x = x, y = y, fill = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100))) +
geom_polygon(data = sl,
aes(x=long, y=lat, group = group),
fill=NA, color="grey50", size=1.25) +
coord_fixed(ratio = 1) +
labs(fill = "", title = "Envenoming incidence")+
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.95, 0.65),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(15, units = "mm"),
plot.title = element_text(face = "bold",
size = 22,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
cor.env.inc <- modified.ttest(x = env.inc.df$data, y = env.inc.df$model,
coords = env.inc.df[, c("x", "y")])
cor.inc.env <- ggplot(env.inc.df) + geom_hex(aes(x = data, y = model)) +
scale_fill_gradientn(colours = rev(cool.cols(100)), trans = "log") +
xlim(0, 0.0075) + ylim(0, 0.0075) + coord_fixed(ratio = 1) +
geom_abline(slope = 1, intercept = 0, colour = "red", size = 1.5, alpha = 0.5) +
geom_text(aes(x = 0.0025, y = 0.005, label= paste0(
"r = ", round(cor.env.inc$corr,2),
"\n d.f. = ", round(cor.env.inc$dof, 0),
"\n P = ", round(cor.env.inc$p.value, 2)
)), fontface = "plain", size = 6) +
labs(x = "Data", y = "Model") +
theme(
legend.position = "none",
panel.background = element_rect(colour = "grey40", fill = "white"),
rect = element_rect(fill = "transparent"),
axis.title = element_text(size = 18)
)
env.incid.inset = ggdraw() +
draw_plot(env.inc) +
draw_plot(cor.inc.env, x = 0.6, y = 0.7, width = 0.3, height = 0.3)
##
source("Random functions/multiplot.R")
pdf("Figures/Envenoming-maps.pdf", width = 7.5, height = 21)
multiplot(env.incid.inset, envs.inset, cols = 1)
dev.off()
pdf("Figures/Snakebite-maps.pdf", width = 7.5, height = 21)
multiplot(bit.incid.inset, bites.inset, cols = 1)
dev.off()
################
# Rho
rho.bites <- raster("Model-results/Spatial/Snakebites/Rho.asc")
rho.b.df <- data.frame(rasterToPoints(rho.bites))
rho.envs <- raster("Model-results/Spatial/Envenomings/Rho.asc")
rho.e.df <- data.frame(rasterToPoints(rho.envs))
cool <- colorRampPalette(c("orangered1", "goldenrod1", "darkturquoise"))
rho.b.pl <- ggplot(rho.b.df) + geom_raster(aes(x = x, y = y, fill = Rho)) +
scale_fill_gradientn(colours = rev(cool(100))) +
geom_polygon(data = sl,
aes(x=long, y=lat, group = group),
fill=NA, color="grey50", size=1.25) +
coord_fixed(ratio = 1) +
labs(fill = "", title = "Random effects")+
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.95, 0.75),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(size = 20,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
rho.e.pl <- ggplot(rho.e.df) + geom_raster(aes(x = x, y = y, fill = Rho)) +
scale_fill_gradientn(colours = rev(cool(100))) +
geom_polygon(data = sl,
aes(x=long, y=lat, group = group),
fill=NA, color="grey50", size=1.25) +
coord_fixed(ratio = 1) +
labs(fill = "", title = "Random effects")+
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.95, 0.75),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(size = 20,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
pdf("Figures/Rho-snakebites.pdf", width = 7.5/2, height = 21/4)
rho.b.pl
dev.off()
pdf("Figures/Rho-envenomings.pdf", width = 7.5/2, height = 21/4)
rho.e.pl
dev.off()
### RMSE
rmse.sb <- readRDS("Model-results/SLA-disctricts-CAR-RMSE.rds")
rmse.env <- readRDS("Model-results/SLA-districts-CAR-RMSE-envs.rds")
# Snakebites
rmse.sb.pl <- ggplot(rmse.sb, aes(x = long, y = lat, group = group, fill = rmse)) +
geom_polygon(colour = "grey50") +
scale_fill_gradientn(colours = rev(cool(100))) +
coord_equal() +
labs(x = "x", y = "y", title = "RMSE", fill = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(size = 20,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
rmse.env.pl <- ggplot(rmse.env, aes(x = long, y = lat, group = group, fill = rmse.env)) +
geom_polygon(colour = "grey50") +
scale_fill_gradientn(colours = rev(cool(100))) +
coord_equal()+
labs(x = "x", y = "y", title = "RMSE", fill = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(size = 20,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
pdf("Figures/RMSE-snakebites.pdf", width = 7.5/2, height = 21/4)
rmse.sb.pl
dev.off()
pdf("Figures/RMSE-envenomings.pdf", width = 7.5/2, height = 21/4)
rmse.env.pl
dev.off()
## Survey data
surv.data <- read.csv("Data/data.for.prevmap.csv")
library(sp)
coordinates(surv.data) <- ~ cluster_long + cluster_lat
proj4string(surv.data) <- CRS("+init=epsg:4326")
surv.data.sl <- spTransform(surv.data, CRSobj = CRS("+init=epsg:5235"))
surv.data.df <- data.frame(coordinates(surv.data.sl), surv.data.sl@data)
sb.incid.r <- raster("Model-results/Spatial/Snakebites/Incidence.asc")
env.incid.r <- raster("Model-results/Spatial/Envenomings/Incidence.asc")
surv.data.df$sb.pred <- extract(sb.incid.r, coordinates(surv.data.sl))
surv.data.df$env.pred <- extract(env.incid.r, coordinates(surv.data.sl))
surv.data.df$sb.prev <- with(surv.data.df, n_bitten/n_sampled)
surv.data.df$env.prev <- with(surv.data.df, n_envenom/n_sampled)
surv.data.df$sb.resids <- with(surv.data.df, sb.prev - sb.pred)
surv.data.df$env.resids <- with(surv.data.df, env.prev - env.pred)
sb.res.pl <-ggplot() + geom_polygon(data = sl, aes(x = long, y = lat, group = group), fill = "lightgrey") +
geom_point(data = surv.data.df, aes(x = cluster_long, y = cluster_lat, size = sb.resids), shape = 1, alpha = 0.3)+
scale_color_gradientn(colours = rev(cool(100))) +
coord_equal() +
labs(x = "x", y = "y", title = "Survey data residuals", size = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(size = 20,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
env.res.pl <-ggplot() + geom_polygon(data = sl, aes(x = long, y = lat, group = group), fill = "lightgrey") +
geom_point(data = surv.data.df, aes(x = cluster_long, y = cluster_lat, size = env.resids), shape = 1, alpha = 0.3)+
scale_color_gradientn(colours = rev(cool(100))) +
coord_equal() +
labs(x = "x", y = "y", title = "Survey data residuals", size = "") +
theme(panel.background =  element_rect(colour = NA, fill = NA),
legend.position = c(0.9, 0.8),
legend.background = element_rect("transparent"),
legend.text = element_text(size = 12),
legend.key.height = unit(5, units = "mm"),
legend.key.width = unit(7.5, units = "mm"),
plot.title = element_text(size = 20,
hjust = 0.5),
axis.text = element_text(size = 12),
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title = element_text(face = "plain", size = 12))
pdf("Figures/Survey-residuals-snakebites.pdf", width = 7.5/2, height = 21/4)
sb.res.pl
dev.off()
pdf("Figures/Survey-residuals-envenomings.pdf", width = 7.5/2, height = 21/4)
env.res.pl
dev.off()
library(nimble); library(raster); library(spdep)
modelCode <- nimbleCode({
#Likelihood
for(i in 1:n){
logit(P[i]) <- inter[class[i]] + inprod(s.effects[], S[i,])
log(env[i]) <- log(P[i] * Hum.bit[i]) + rho[i]
P.r[i] <- r/(r + env[i])
Hum.env[i] ~ dnegbin(P.r[i], r)
}
#Priors
rho[1:n] ~ dcar_normal(adj[1:L], weights[1:L], num[1:n], tau, zero_mean = 0)
sigma ~ dunif(0, 10)   # prior for variance components
tau <- 1 / sigma^2
for(j in 1:n.species){
s.effects[j] ~ dnorm(E.s[j], sd = sd.s[j])
}
for(k in 1:n.classes){inter[k] ~ dnorm(E.int[k], sd = sd.int[k])}
r ~ dunif(0, 50)
})
incid.data <- read.csv("Data/Incid-data.csv")[, -1]
indices <- read.csv("Data/Agressivenes-indices.csv")
snake.pars <- read.csv("Data/Parameters-questions.csv")
rel.abund <- with(snake.pars, Density_5k)
bites.model <- readRDS("Model-results/Snakebites-mass-action-NIMBLE-model.rds")
bites.hum.pars <- bites.model[[1]]
model.bites <- raster("Model-results/Incidence-NIMBLE-model-SI.asc")
getwd()
model.bites <- raster("Model-results/Spatial/Snakebites/Incidence-NIMBLE-model-SI.asc")
model.bites <- raster("Model-results/Spatial/Snakebites/Incidence.asc")
Hum.log <- log(incid.data$hum.pop)
bit.inc <- extract(model.bites, incid.data[, c("x", "y")])
env.inc <- incid.data$envenomings
env.inc <- ifelse(env.inc > bit.inc, bit.inc, env.inc)
Hum.env <- ceiling(env.inc * incid.data$hum.pop)
Hum.bit <- ceiling(bit.inc * incid.data$hum.pop)
S <- as.matrix(incid.data[, 3:9])
max.s <- apply(S, 2, max)
S <- sweep(S, 2, max.s, "/")
S <- sweep(S, 2, rel.abund, "*")
S.tot <- rowSums(S)
S.prop <- sweep(S, 2, S.tot, "/")
S.prop <- sweep(S, 1, S.tot, "/")
S.prop.r <- rasterFromXYZ(data.frame(incid.data[, c("x", "y")], S.prop))
plot(S.prop.r)
for(i in 1:7)plot(S.prop.r[[i]])
names(S.prop.r)
for(i in 1:7)plot(S.prop.r[[i]], main = names(S.prop.r[i]))
for(i in 1:7)plot(S.prop.r[[i]], main = names(S.prop.r)[i])
S.r <- rasterFromXYZ(data.frame(incid.data[, c("x", "y")], S))
for(i in 1:7){plot(S.prop.r[[i]], main = names(S.prop.r)[i])}
par(mfrow = c(1, 2))
for(i in 1:7){plot(S.prop.r[[i]], main = names(S.prop.r)[i]); plot(S.r[[i]])}
plot(sum(S.prop.r))
